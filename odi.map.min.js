/**
  ODI Leeds Tiny Slippy Map
  Version 0.1.2
**/
!function(t){var e=t.ODI||{};e.ready||(e.ready=function(t){"loading"!=document.readyState?t():document.addEventListener("DOMContentLoaded",t)});var i=256,s=Math.PI,o={};function n(t,e){var s,n,a,r,l;if(this.version="0.1.2",this.logging=location.search.indexOf("debug=true")>=0,this.log=function(){if(this.logging||"ERROR"==arguments[0]||"WARNING"==arguments[0]){var t=Array.prototype.slice.call(arguments,0),e=["%cODI Map "+this.version+"%c: "+t[1],"font-weight:bold;",""];t.length>2&&(e=e.concat(t.splice(2))),console&&"function"==typeof console.log&&("ERROR"==arguments[0]?console.error.apply(null,e):"WARNING"==arguments[0]?console.warn.apply(null,e):"INFO"==arguments[0]?console.info.apply(null,e):console.log.apply(null,e))}return this},!t||!t.tagName)return this.log("WARNING","No DOM element provided"),this;for(r in e||(e={}),e.center||(e.center=[0,0]),"number"!=typeof e.maxZoom&&(e.maxZoom=19),"boolean"!=typeof e.scrollWheelZoom&&(e.scrollWheelZoom=!0),"boolean"!=typeof e.zoomControl&&(e.zoomControl=!0),"boolean"!=typeof e.attributionControl&&(e.attributionControl=!0),l=!1,this.panes={el:document.createElement("div"),p:{tile:{},overlay:{},marker:{},labels:{}}},this.controls={},this.addPane=function(t){if(!this.panes.p[t]||!this.panes.p[t].el){var e=document.createElement("div");e.classList.add("odi-map-pane","odi-map-pane-"+t),this.panes.p[t]={el:e,layers:[]},m(e,this.panes.el)}return this},this.tileLayer=function(t,e){return e.pane||(e.pane="tile"),new d(t,e)},this.updateLayers=function(t,e){var i,s,o;"number"!=typeof e&&(e=this.getZoom()),t||(t=this.getBounds());var n="";for(i in this.panes.p)if(this.panes.p[i])for(s in this.panes.p[i].layers)this.panes.p[i].layers[s]&&(this.panes.p[i].layers[s].update(t,e),o=this.panes.p[i].layers[s]._attr.attribution,n.indexOf(o)<0&&(n+=o));return this.controls.credit&&(this.controls.credit.innerHTML=n+" | ODI Map"),this},this.getZoom=function(){return n},this.setZoom=function(t,i){return n=Math.min(t,e.maxZoom),a=this.getBounds(),this.updateLayers(a,n),this},this.zoomIn=function(t){return this.setZoom(n+t)},this.zoomOut=function(t){return this.setZoom(n-t)},this.getCenter=function(){return s},this.getBounds=function(){var e,o,a;return e=t.offsetHeight/(2*i),o=t.offsetWidth/(2*i),p(c((a=s.toTile(n)).x-o,a.y+e).toLatLon(n),c(a.x+o,a.y-e).toLatLon(n))},this.fitBounds=function(e){var o,n,r,l,h,u,d;for(a=e?p({lat:e[0][0],lon:e[0][1]},{lat:e[1][0],lon:e[1][1]}):this.getBounds(),s=a.getCenter(),o=t.offsetHeight/(2*i),n=t.offsetWidth/(2*i),r=0;r<19&&(l=c((d=s.toTile(r)).x-n,d.y-o).toLatLon(r),c(d.x+n,d.y+o).toLatLon(r),h=a.nw.lat-l.lat,u=l.lon-a.nw.lon,!(h>=0&&u>=0));r++);return this.setZoom(r,!1),this},this.panBy=function(t,e){e||(e={animate:!1,duration:.25}),s=s.toTile(n).shift(t).toLatLon(n),this.updateLayers()},this.addControl=function(e,i,s){return this.controls[e]||(this.controls[e]=document.createElement("div"),m(this.controls[e],t)),this.controls[e].classList.add(...i.split(/ /)),s&&(this.controls[e].innerHTML=s),this.controls[e]},s=h(e.center[0],e.center[1]),this.setZoom(e.zoom||12),t.classList.add("odi-map"),this.panes.el.classList.add("odi-map-panes"),m(this.panes.el,t),e.attributionControl&&this.addControl("credit","odi-map-control odi-map-attribution odi-map-bottom odi-map-right",""),e.zoomControl&&(this.addControl("zoom","odi-map-control odi-map-zoom odi-map-top odi-map-left",'<button class="odi-map-zoom-in" title="Zoom in">+</button><button class="odi-map-zoom-out" title="Zoom out">âˆ’</button>'),y("click",this.controls.zoom.querySelector(".odi-map-zoom-in"),{this:this},function(t){this.zoomIn(1)}),y("click",this.controls.zoom.querySelector(".odi-map-zoom-out"),{this:this},function(t){this.zoomOut(1)})),this.panes.p)this.panes.p[r]&&this.addPane(r);new ResizeObserver(t=>{this.updateLayers()}).observe(this.panes.el);var f={};for(r in this.trigger=function(t){var i=t.type;if("pointerdown"!=i||l)if("pointerup"==i)l=!1,t.preventDefault();else if("pointermove"==i&&l){var s={x:f.x-t.clientX,y:f.y-t.clientY};this.panBy(s),f={x:t.clientX,y:t.clientY}}else"wheel"==i&&e.scrollWheelZoom&&(t.preventDefault(),t.wheel=t.deltaY?-t.deltaY:t.wheelDelta/40,this.setZoom(n+(t.wheel>=0?1:-1)));else t.preventDefault(),l=!0,f={x:t.clientX,y:t.clientY}},y("wheel",this.panes.el,{this:this,p:r},this.trigger),y("click",this.panes.el,{this:this,p:r},this.trigger),y("pointerdown",this.panes.el,{this:this,p:r},this.trigger),y("pointerup",this.panes.el,{this:this,p:r},this.trigger),y("pointermove",this.panes.el,{this:this,p:r},this.trigger),y("drag",this.panes.el,{this:this,p:r},this.trigger),this.Layer=u,this.Bounds=p,this.LatLon=h,this.Tile=c,o)o[r]&&o[r].exec(this);return this}n.prototype.register=function(t,e){return o[t]&&this.log("WARNING","Plugin "+t+" already exists"),"function"==typeof e.exec&&(o[t]=e),this};class a{constructor(t,e){this.nw=h(Math.max(t.lat,e.lat),Math.min(t.lon,e.lon)),this.se=h(Math.min(t.lat,e.lat),Math.max(t.lon,e.lon))}getCenter(){return h((this.nw.lat-this.se.lat)/2+this.se.lat,(this.se.lon-this.nw.lon)/2+this.nw.lon)}}class r{constructor(t,e){this.lat=t,this.lon=e}toTile(t){return c((this.lon+180)/360*Math.pow(2,t),(1-Math.log(Math.tan(this.lat*s/180)+1/Math.cos(this.lat*s/180))/s)/2*Math.pow(2,t))}}class l{constructor(t,e){return this.x=t,this.y=e,this.xint=Math.floor(this.x),this.yint=Math.floor(this.y),this}shift(t){return this.x+=t.x/i,this.y+=t.y/i,this.xint=Math.floor(this.x),this.yint=Math.floor(this.y),this}toLatLon(t){var e=s-2*s*this.y/Math.pow(2,t);return h(180/s*Math.atan(.5*(Math.exp(e)-Math.exp(-e))),this.x/Math.pow(2,t)*360-180)}getTranslate(t){return t||(t={x:0,y:0}),"translate3d("+(this.x-t.x)*i+"px,"+(this.y-t.y)*i+"px,0)"}}function h(t,e){return new r(t||0,e||0)}function p(t,e){return new a(t||h(),e||h())}function c(t,e){return new l(t||0,e||0)}class u{constructor(t,e){return this._attr=t||{},this._el=document.createElement("div"),this._el.classList.add("odi-map-layer"),this}addTo(t){this._map=t;var e=this._attr.pane;return t.panes.p[e]?(t.panes.p[e].el.appendChild(this._el),t.panes.p[e].layers.push(this),this.update(this._map.getBounds(),this._map.getZoom()),this):t.log("ERROR","No pane %c"+e+"%c exists.","font-style:italic;","")}update(t,e){return this}}class d extends u{constructor(t,e){super(e),this._url=t||"",this._tiles={}}update(t,e){var s,o,n,a;for(a=t.getCenter().toTile(e),s=this.getTiles(t,e),Math.pow(2,e),o=0;o<s.length;o++)n=e+"/"+s[o].tile.x+"/"+s[o].tile.y,this._tiles[n]||(this._tiles[n]={el:document.createElement("img"),tile:s[o].tile,z:s[o].z},this._tiles[n].el.classList.add("odi-map-tile"),f(this._tiles[n].el,{id:n,src:s[o].url}),this._tiles[n].el.style.width=i+"px",this._tiles[n].el.style.height=i+"px"),this._tiles[n].el.style.transform=s[o].tile.getTranslate(a),m(this._tiles[n].el,this._el);for(n in this._tiles)this._tiles[n].z!=e&&this._tiles[n].el&&(this._tiles[n].el.parentNode.removeChild(this._tiles[n].el),delete this._tiles[n]);return this}getTiles(t,e){var i,s,o,n,a,r,l,h;for(this._attr.subdomains||(this._attr.subdomains="abc"),l=this._attr.subdomains.length,i=t.nw.toTile(e),s=t.se.toTile(e),o=[],n=i.xint;n<=s.xint;n++)for(l>0&&(r=n%l),a=i.yint;a<=s.yint;a++)h=this._url.replace(/\{z\}/g,e).replace(/\{y\}/g,a).replace(/\{x\}/g,n).replace(/\{r\}/g,window.devicePixelRatio>1?"@2x":""),l>0&&(h=h.replace(/\{s\}/g,this._attr.subdomains[r])),o.push({url:h,z:e,tile:c(n,a)});return o}}function m(t,e){return e.appendChild(t)}function f(t,e){for(var i in e)e[i]&&t.setAttribute(i,e[i]);return t}function y(t,e,i,s){e&&(e.length||(e=[e]),"function"==typeof s&&e.forEach(function(e){e.addEventListener(t,function(t){t.data=i,s.call(i.this||this,t)})}))}e.map=n,t.ODI=e}(window||this);