/**
  ODI Leeds Tiny Slippy Map
  Version 0.1.4
**/
!function(t){var e=t.ODI||{};e.ready||(e.ready=function(t){"loading"!=document.readyState?t():document.addEventListener("DOMContentLoaded",t)});var i=256,o=Math.PI,s={};function n(t,e){var o,n,a,r,l;if(this.version="0.1.4",this.logging=location.search.indexOf("debug=true")>=0,this.log=function(){if(this.logging||"ERROR"==arguments[0]||"WARNING"==arguments[0]){var t=Array.prototype.slice.call(arguments,0),e=["%cODI Map "+this.version+"%c: "+t[1],"font-weight:bold;",""];t.length>2&&(e=e.concat(t.splice(2))),console&&"function"==typeof console.log&&("ERROR"==arguments[0]?console.error.apply(null,e):"WARNING"==arguments[0]?console.warn.apply(null,e):"INFO"==arguments[0]?console.info.apply(null,e):console.log.apply(null,e))}return this},!t||!t.tagName)return this.log("WARNING","No DOM element provided"),this;for(r in e||(e={}),e.center||(e.center=[0,0]),"number"!=typeof e.maxZoom&&(e.maxZoom=19),"boolean"!=typeof e.scrollWheelZoom&&(e.scrollWheelZoom=!0),"boolean"!=typeof e.zoomControl&&(e.zoomControl=!0),"boolean"!=typeof e.attributionControl&&(e.attributionControl=!0),l=!1,this.panes={el:document.createElement("div"),p:{tile:{},overlay:{},marker:{},labels:{}}},this.controls={},this.addPane=function(t){if(!this.panes.p[t]||!this.panes.p[t].el){var e=document.createElement("div");e.classList.add("odi-map-pane","odi-map-pane-"+t),this.panes.p[t]={el:e,layers:[]},m(e,this.panes.el)}return this},this.tileLayer=function(t,e){return e.pane||(e.pane="tile"),new d(t,e)},this.updateLayers=function(t,e){var i,o,s,n;for(i in"number"!=typeof e&&(e=this.getZoom()),t||(t=this.getBounds()),{x:0,y:0},n="",this.panes.p)if(this.panes.p[i])for(o in this.panes.p[i].layers)this.panes.p[i].layers[o]&&(this.panes.p[i].layers[o].update(t,e),s=this.panes.p[i].layers[o]._attr.attribution,n.indexOf(s)<0&&(n+=s));return this.controls.credit&&(this.controls.credit.innerHTML=n+" | ODI Map"),this},this.getZoom=function(){return n},this.setZoom=function(t,i){return n=Math.min(t,e.maxZoom),a=this.getBounds(),i||this.updateLayers(a,n),this},this.zoomIn=function(t){return this.setZoom(n+t)},this.zoomOut=function(t){return this.setZoom(n-t)},this.getCenter=function(){return o},this.getBounds=function(){var e,s,a;return e=t.offsetHeight/(2*i),s=t.offsetWidth/(2*i),p(u((a=o.toTile(n)).x-s,a.y+e).toLatLon(n),u(a.x+s,a.y-e).toLatLon(n))},this.fitBounds=function(e){var s,n,r,l,h,c,d;for(a=e?p({lat:e[0][0],lon:e[0][1]},{lat:e[1][0],lon:e[1][1]}):this.getBounds(),o=a.getCenter(),s=t.offsetHeight/(2*i),n=t.offsetWidth/(2*i),r=0;r<19&&(l=u((d=o.toTile(r)).x-n,d.y-s).toLatLon(r),u(d.x+n,d.y+s).toLatLon(r),h=a.nw.lat-l.lat,c=l.lon-a.nw.lon,!(h>=0&&c>=0));r++);return this.setZoom(r,!1),this},this.panBy=function(t,e){e||(e={animate:!1,duration:.25}),o=o.toTile(n).shift(t).toLatLon(n),this.updateLayers()},this.addControl=function(e,i,o){return this.controls[e]||(this.controls[e]=document.createElement("div"),m(this.controls[e],t)),this.controls[e].classList.add(...i.split(/ /)),o&&(this.controls[e].innerHTML=o),this.controls[e]},o=h(e.center[0],e.center[1]),this.setZoom(e.zoom||12,!0),t.classList.add("odi-map"),this.panes.el.classList.add("odi-map-panes"),m(this.panes.el,t),e.attributionControl&&this.addControl("credit","odi-map-control odi-map-attribution odi-map-bottom odi-map-right",""),e.zoomControl&&(this.addControl("zoom","odi-map-control odi-map-zoom odi-map-top odi-map-left",'<button class="odi-map-zoom-in" title="Zoom in">+</button><button class="odi-map-zoom-out" title="Zoom out">âˆ’</button>'),g("click",this.controls.zoom.querySelector(".odi-map-zoom-in"),{this:this},function(t){this.zoomIn(1)}),g("click",this.controls.zoom.querySelector(".odi-map-zoom-out"),{this:this},function(t){this.zoomOut(1)})),this.panes.p)this.panes.p[r]&&this.addPane(r);var f=!1;new ResizeObserver(t=>{f&&this.updateLayers()}).observe(this.panes.el);var y={};for(r in this.trigger=function(t){t.preventDefault(),t.stopPropagation();var i=t.type;if("pointerdown"==i)l=!0,y={x:t.pageX,y:t.pageY};else if("pointerup"==i)l=!1;else if("pointermove"!=i&&"touchmove"!=i||!l)"wheel"==i&&e.scrollWheelZoom&&(t.wheel=t.deltaY?-t.deltaY:t.wheelDelta/40,this.setZoom(n+(t.wheel>=0?1:-1)));else{var o="touchmove"==i?t.touches[0]:t,s={x:y.x-o.pageX,y:y.y-o.pageY};this.panBy(s),y={x:o.pageX,y:o.pageY}}},g("wheel",this.panes.el,{this:this,p:r},this.trigger),g("pointerdown",this.panes.el,{this:this,p:r},this.trigger),g("pointerup",this.panes.el,{this:this,p:r},this.trigger),"ontouchstart"in document.documentElement?g("touchmove",this.panes.el,{this:this,p:r},this.trigger):g("pointermove",this.panes.el,{this:this,p:r},this.trigger),this.Layer=c,this.Bounds=p,this.LatLon=h,this.Tile=u,s)s[r]&&s[r].exec(this);return f=!0,this}n.prototype.register=function(t,e){return s[t]&&this.log("WARNING","Plugin "+t+" already exists"),"function"==typeof e.exec&&(s[t]=e),this};class a{constructor(t,e){this.nw=h(Math.max(t.lat,e.lat),Math.min(t.lon,e.lon)),this.se=h(Math.min(t.lat,e.lat),Math.max(t.lon,e.lon))}getCenter(){return h((this.nw.lat-this.se.lat)/2+this.se.lat,(this.se.lon-this.nw.lon)/2+this.nw.lon)}}class r{constructor(t,e){this.lat=t,this.lon=e}toTile(t){return u((this.lon+180)/360*Math.pow(2,t),(1-Math.log(Math.tan(this.lat*o/180)+1/Math.cos(this.lat*o/180))/o)/2*Math.pow(2,t))}}class l{constructor(t,e){return this.x=t,this.y=e,this.xint=Math.floor(this.x),this.yint=Math.floor(this.y),this}shift(t){return this.x+=t.x/i,this.y+=t.y/i,this.xint=Math.floor(this.x),this.yint=Math.floor(this.y),this}toLatLon(t){var e=o-2*o*this.y/Math.pow(2,t);return h(180/o*Math.atan(.5*(Math.exp(e)-Math.exp(-e))),this.x/Math.pow(2,t)*360-180)}getTranslate(t){return t||(t={x:0,y:0}),"translate3d("+(this.x-t.x)*i+"px,"+(this.y-t.y)*i+"px,0)"}}function h(t,e){return new r(t||0,e||0)}function p(t,e){return new a(t||h(),e||h())}function u(t,e){return new l(t||0,e||0)}class c{constructor(t,e){return this._attr=t||{},this._el=document.createElement("div"),this._el.classList.add("odi-map-layer"),this}addTo(t){this._map=t;var e=this._attr.pane;return t.panes.p[e]?(t.panes.p[e].el.appendChild(this._el),t.panes.p[e].layers.push(this),this.update(this._map.getBounds(),this._map.getZoom()),this):t.log("ERROR","No pane %c"+e+"%c exists.","font-style:italic;","")}update(t,e){return this}}class d extends c{constructor(t,e){super(e),this._url=t||"",this._tiles={}}update(t,e){var o,s,n,a;for(a=t.getCenter().toTile(e),o=this.getTiles(t,e),Math.pow(2,e),s=0;s<o.length;s++)n=e+"/"+o[s].tile.x+"/"+o[s].tile.y,this._tiles[n]||(this._tiles[n]={el:document.createElement("img"),tile:o[s].tile,z:o[s].z},this._tiles[n].el.classList.add("odi-map-tile"),f(this._tiles[n].el,{id:n,src:o[s].url}),this._tiles[n].el.style.width=i+"px",this._tiles[n].el.style.height=i+"px"),this._tiles[n].el.style.transform=o[s].tile.getTranslate(a),m(this._tiles[n].el,this._el);for(n in this._tiles)this._tiles[n].z!=e&&this._tiles[n].el&&(this._tiles[n].el.parentNode.removeChild(this._tiles[n].el),delete this._tiles[n]);return this}getTiles(t,e){var i,o,s,n,a,r,l,h;for(this._attr.subdomains||(this._attr.subdomains="abc"),l=this._attr.subdomains.length,i=t.nw.toTile(e),o=t.se.toTile(e),s=[],n=i.xint;n<=o.xint;n++)for(l>0&&(r=n%l),a=i.yint;a<=o.yint;a++)h=this._url.replace(/\{z\}/g,e).replace(/\{y\}/g,a).replace(/\{x\}/g,n).replace(/\{r\}/g,window.devicePixelRatio>1?"@2x":""),l>0&&(h=h.replace(/\{s\}/g,this._attr.subdomains[r])),s.push({url:h,z:e,tile:u(n,a)});return s}}function m(t,e){return e.appendChild(t)}function f(t,e){for(var i in e)e[i]&&t.setAttribute(i,e[i]);return t}function g(t,e,i,o){e&&(e.length||(e=[e]),"function"==typeof o&&e.forEach(function(e){e.addEventListener(t,function(t){t.data=i,o.call(i.this||this,t)})}))}e.map=n,t.ODI=e}(window||this);