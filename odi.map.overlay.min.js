/**
  ODI Leeds Tiny Slippy Map
  Plugin for GeoJSON
  Version 0.1
**/
!function(t){function e(t){return document.createElementNS(i,t)}var s=t.ODI||{};if(s.map){var i="http://www.w3.org/2000/svg";s.map.prototype.register("geojson",{version:"0.1",exec:function(t){s.map.geoJSON=function(o,n){return n||(n={}),n.pane||(n.pane="overlay"),new class extends t.Layer{constructor(t,o,n){super(o,n),this._json=t||{},console.log("constructor",this),this._svg=e("svg"),s._setAttr(this._svg,{xmlns:i,version:"1.1",overflow:"visible",preserveAspectRatio:"xMinYMin meet","vector-effect":"non-scaling-stroke"}),this._el.appendChild(this._svg)}update(t,i){var o,n,r,h,a,l,f,p,_,g,u,d;for(o=t.getCenter().toPx(i),h=t.nw.toPx(i),a=t.se.toPx(i),s._setAttr(this._svg,{viewBox:(h.x-o.x).toFixed(3)+" "+(h.y-o.y).toFixed(3)+" "+(a.x-h.x).toFixed(3)+" "+(a.y-h.y).toFixed(3)}),n=0;n<this._json.features.length;n++){if(d={},"function"==typeof this._attr.style&&(d=this._attr.style.call(this,this._json.features[n])||{}),f=this._json.features[n].geometry.coordinates,"Point"==this._json.features[n].geometry.type)r=this._map.LatLon(f[1],f[0]).toPx(i),this._json.features[n].el||(l=e("circle"),s._setAttr(l,{r:5,fill:"black"}),this._svg.appendChild(l),this._json.features[n].el=l),d.cx=r.x-o.x,d.cy=r.y-o.y;else if("Polygon"==this._json.features[n].geometry.type){for(this._json.features[n].el||(l=e("path"),this._svg.appendChild(l),this._json.features[n].el=l),u="",p=0;p<f.length;p++)for(_=0;_<f[p].length;_++)r=this._map.LatLon(f[p][_][1],f[p][_][0]).toPx(i),u+=(0==_?"M":"L")+" "+(r.x-o.x)+" "+(r.y-o.y);d.d=u}else if("LineString"==this._json.features[n].geometry.type){for(this._json.features[n].el||(l=e("path"),s._setAttr(l,{r:5,stroke:"black","stroke-width":1,fill:"none"}),this._svg.appendChild(l),this._json.features[n].el=l),u="",p=0;p<f.length;p++)r=this._map.LatLon(f[p][1],f[p][0]).toPx(i),u+=(0==p?"M":"L")+(r.x-o.x)+" "+(r.y-o.y);d.d=u}else if("MultiLineString"==this._json.features[n].geometry.type){for(this._json.features[n].el||(l=e("path"),s._setAttr(l,{r:5,stroke:"black","stroke-width":1,fill:"none"}),this._svg.appendChild(l),this._json.features[n].el=l),u="",p=0;p<f.length;p++)for(_=0;_<f[p].length;_++)r=this._map.LatLon(f[p][_][1],f[p][_][0]).toPx(i),u+=(0==_?"M":"L")+(r.x-o.x)+" "+(r.y-o.y);d.d=u}else if("MultiPolygon"==this._json.features[n].geometry.type){for(this._json.features[n].el||(l=e("path"),this._svg.appendChild(l),this._json.features[n].el=l),u="",p=0;p<f.length;p++)for(_=0;_<f[p].length;_++)if(2!=f[p][_].length)for(g=0;g<f[p][_].length;g++)r=this._map.LatLon(f[p][_][g][1],f[p][_][g][0]).toPx(i),u+=(0==g?"M":"L")+" "+(r.x-o.x)+" "+(r.y-o.y);d.d=u}this._json.features[n].el.innerHTML=d.title?"<title>"+d.title+"</title>":"",s._setAttr(this._json.features[n].el,d)}}addTo(t){var e,i;this._map=t;var o=this._attr.pane;if(!t.panes.p[o])return t.log("ERROR","No pane %c"+o+"%c exists.","font-style:italic;","");t.panes.p[o].el.appendChild(this._el),t.panes.p[o].layers.push(this),this.update(this._map.getBounds(),this._map.getZoom()),console.log("addTo",this._el),e=this._el.offsetWidth,i=this._el.offsetHeight,s._setAttr(this._svg,{viewBox:"0 0 "+e+" "+i,width:e,height:i})}}(o,n)}}})}t.ODI=s}(window||this);